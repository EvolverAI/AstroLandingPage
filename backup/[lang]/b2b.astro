---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import DynamicSection from "../../components/DynamicSection.astro";
import { getEntry } from "astro:content";

// Get language from URL parameter using the same pattern as the main site
export async function getStaticPaths() {
    return [
        { params: { lang: "en" } },
        { params: { lang: "de" } },
        { params: { lang: "it" } },
    ];
}

const { lang } = Astro.params;
const language = lang || "en";

// Load page configuration from B2B-specific language file
let pageSections: any[] = [];
try {
    const langData = await getEntry("languages", `b2b-${language}`);
    pageSections = langData?.data?.page_sections || [];
    // Sort sections by order
    pageSections.sort((a: any, b: any) => (a.order || 0) - (b.order || 0));
} catch (error) {
    console.warn(
        "Could not load B2B page sections for language:",
        language,
        error,
    );
    // Fallback to English if the requested language doesn't exist
    try {
        const fallbackData = await getEntry("languages", "b2b-en");
        pageSections = fallbackData?.data?.page_sections || [];
        pageSections.sort((a: any, b: any) => (a.order || 0) - (b.order || 0));
    } catch (fallbackError) {
        console.error(
            "Could not load fallback B2B page sections:",
            fallbackError,
        );
    }
}

// Dynamic titles and descriptions based on language
const titles = {
    en: "B2B Outsourcing Solutions - Premium Business Services | EvolverAI",
    de: "B2B-Outsourcing-Lösungen - Premium-Geschäftsdienste | EvolverAI",
    it: "Soluzioni di Outsourcing B2B - Servizi Aziendali Premium | EvolverAI",
};

const descriptions = {
    en: "Premium B2B outsourcing solutions with strategic partnerships and AI-enhanced services. Transform your operations through our comprehensive business process optimization.",
    de: "Premium B2B-Outsourcing-Lösungen mit strategischen Partnerschaften und KI-erweiterten Diensten. Transformieren Sie Ihre Abläufe durch unsere umfassende Geschäftsprozessoptimierung.",
    it: "Soluzioni di outsourcing B2B premium con partnership strategiche e servizi potenziati dall'IA. Trasforma le tue operazioni attraverso la nostra ottimizzazione completa dei processi aziendali.",
};
---

<Layout title={titles[language]} description={descriptions[language]}>
    <Header currentLanguage={language} />

    <main class="space-y-0">
        <!-- Dynamically render sections from B2B YAML configuration -->
        {
            pageSections.map((sectionConfig) => (
                <DynamicSection
                    sectionConfig={sectionConfig}
                    language={language}
                    languageFile={`b2b-${language}`}
                />
            ))
        }
    </main>

    <Footer language={language} />
</Layout>
